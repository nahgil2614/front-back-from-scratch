var a,c=document.getElementById("myCanvas"),b=c.getContext("2d"),r=0,m=Math.floor(16777216*Math.random());function z(t=!1){var e=new XMLHttpRequest;return e.open("GET","getPoints?"+(t?"new&":"")+m),e.onload=function(){a=z();var t=JSON.parse(this.responseText);h(t.slice(r)),r=t.length},e.send(),e}function draw(t){var e=f(c,t);j(e,m),g(e)}function f(t,e){var n=t.getBoundingClientRect();return{x:e.clientX-n.left,y:e.clientY-n.top}}function j(t,e){b.beginPath(),b.arc(t.x,t.y,5,0,2*Math.PI),b.fillStyle="#"+e.toString(16),b.stroke(),b.fill()}function h(t){for(let e=0;e<t.length;++e)j({x:t[e][0],y:t[e][1]},t[e][2])}function g(t){for(;void 0===a;);a.abort();var e=new XMLHttpRequest;e.open("POST","newPoint",!0),e.onload=function(){a=z()},e.send(t.x+","+t.y+","+m)}z(!0),window.addEventListener("beforeunload",function(t){void 0!==a&&a.abort();var e=new XMLHttpRequest;e.open("POST","removeColor",!0),e.send(m)});